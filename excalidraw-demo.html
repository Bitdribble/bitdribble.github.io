---
layout: null
permalink: /excalidraw-demo.html
---
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Excalidraw Editor - {{ site.title | escape }}</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    {%- include head.html -%}
    
    <!-- Excalidraw CSS -->
    <link
      rel="stylesheet"
      href="https://esm.sh/@excalidraw/excalidraw@0.18.0/dist/dev/index.css"
    />
    
    <!-- Custom styles for Excalidraw page -->
    <style>
      body {
        margin: 0;
        padding: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      
      /* Excalidraw container takes remaining space */
      #app {
        flex: 1;
        width: 100%;
        height: 100%;
        position: relative;
        overflow: hidden;
      }
      
      .loading {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        font-size: 1.2rem;
        color: #666;
      }
      
      .error {
        padding: 2rem;
        color: #d32f2f;
        background: #ffebee;
        border: 1px solid #ef5350;
        border-radius: 4px;
        margin: 2rem;
      }
      
      /* File info banner - minimal, below header */
      .file-info-banner {
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        color: #666;
        text-align: center;
      }
      
      .file-info-banner.hidden {
        display: none;
      }
    </style>
    
    <!-- Set Excalidraw asset path -->
    <script>
      window.EXCALIDRAW_ASSET_PATH = "https://esm.sh/@excalidraw/excalidraw@0.18.0/dist/prod/";
    </script>
    
    <!-- Import map for React - must come before any module scripts -->
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18.3.1",
          "react/jsx-runtime": "https://esm.sh/react@18.3.1/jsx-runtime",
          "react-dom": "https://esm.sh/react-dom@18.3.1",
          "react-dom/client": "https://esm.sh/react-dom@18.3.1/client"
        },
        "scopes": {
          "https://esm.sh/": {
            "react": "https://esm.sh/react@18.3.1",
            "react/jsx-runtime": "https://esm.sh/react@18.3.1/jsx-runtime",
            "react-dom": "https://esm.sh/react-dom@18.3.1",
            "react-dom/client": "https://esm.sh/react-dom@18.3.1/client"
          }
        }
      }
    </script>
  </head>
  <body class="bg-gray-50 text-gray-700 font-sans antialiased">
    {%- include header.html -%}
    
    <!-- File info banner -->
    <div id="file-info-banner" class="file-info-banner hidden">
      <span id="file-info-text"></span>
    </div>
    
    <!-- Excalidraw canvas -->
    <div id="app">
      <div class="loading">Loading Excalidraw...</div>
    </div>
    
    <!-- Excalidraw initialization script -->
    <script type="module">
      // Import React at module level using namespace import
      import * as React from "react";
      import * as ReactDOM from "react-dom/client";
      
      // Make React available globally immediately
      window.React = React;
      window.ReactDOM = ReactDOM;
      
      (async () => {
        try {
          // Import Excalidraw - the scoped import map should ensure it uses our React
          const excalidrawModule = await import("https://esm.sh/@excalidraw/excalidraw@0.18.0?external=react,react-dom");
          const { Excalidraw } = excalidrawModule;

          const appElement = document.getElementById("app");
          
          if (!appElement) {
            console.error("Excalidraw: #app element not found");
            return;
          }

          try {
            // Check if a file parameter is provided in the URL
            const urlParams = new URLSearchParams(window.location.search);
            const filePath = urlParams.get('file');
            
            let initialData = null;
            
            // Load Excalidraw file if specified
            if (filePath) {
              try {
                const response = await fetch(filePath);
                if (response.ok) {
                  const excalidrawData = await response.json();
                  // Excalidraw files can have different structures
                  if (excalidrawData.elements) {
                    initialData = {
                      elements: excalidrawData.elements,
                      appState: excalidrawData.appState || {},
                      files: excalidrawData.files || {}
                    };
                    console.log("Loaded Excalidraw file:", filePath);
                    // Update file info banner
                    const fileInfoBanner = document.getElementById("file-info-banner");
                    const fileInfoText = document.getElementById("file-info-text");
                    if (fileInfoBanner && fileInfoText) {
                      fileInfoText.textContent = `Editing: ${filePath}`;
                      fileInfoBanner.classList.remove("hidden");
                    }
                  } else {
                    console.warn("Excalidraw file format not recognized:", filePath);
                  }
                } else {
                  console.error("Failed to load Excalidraw file:", response.statusText);
                }
              } catch (error) {
                console.error("Error loading Excalidraw file:", error);
              }
            }
            
            // Create React root and render Excalidraw
            const root = ReactDOM.createRoot(appElement);
            root.render(
              React.createElement(Excalidraw, {
                initialData: initialData,
                onChange: (elements, appState, files) => {
                  console.log("Excalidraw changed", { elements, appState, files });
                },
                onCollabButtonClick: () => {
                  window.alert("Collaboration feature can be implemented here");
                },
              })
            );
            console.log("Excalidraw initialized successfully");
          } catch (error) {
            console.error("Error initializing Excalidraw:", error);
            appElement.innerHTML = `
              <div class="error">
                <h2>Error loading Excalidraw</h2>
                <p><strong>Error:</strong> ${error.message}</p>
                <p>Please check the browser console (F12) for more details.</p>
                <p><strong>Stack:</strong></p>
                <pre style="font-size: 0.8rem; overflow: auto;">${error.stack || 'No stack trace available'}</pre>
              </div>
            `;
          }
        } catch (error) {
          console.error("Error loading modules:", error);
          const appElement = document.getElementById("app");
          if (appElement) {
            appElement.innerHTML = `
              <div class="error">
                <h2>Error loading Excalidraw modules</h2>
                <p><strong>Error:</strong> ${error.message}</p>
                <p>Failed to load required modules. Please check:</p>
                <ul>
                  <li>Your internet connection</li>
                  <li>Browser console for CORS or network errors</li>
                  <li>That you're using a modern browser with ES module and import map support</li>
                </ul>
                <p><strong>Stack:</strong></p>
                <pre style="font-size: 0.8rem; overflow: auto;">${error.stack || 'No stack trace available'}</pre>
              </div>
            `;
          }
        }
      })();
    </script>
  </body>
</html>
